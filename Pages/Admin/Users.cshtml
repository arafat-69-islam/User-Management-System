@page
@using Demo.Models
@model Demo.Pages.Admin.UsersModel

@{
    ViewData["Title"] = "User Management";
}

<div class="card">
    <div class="card-header d-flex justify-content-between">
        <h3>User Management</h3>
        <div class="btn-group">
            <button type="button" class="btn btn-danger" id="blockUsers">
                <i class="fas fa-ban"></i> Block
            </button>
            <button type="button" class="btn btn-success" id="unblockUsers">
                <i class="fas fa-check"></i> Unblock
            </button>
            <button type="button" class="btn btn-danger" id="deleteUsers">
                <i class="fas fa-trash"></i> Delete
            </button>
        </div>
    </div>
    
    <div class="card-body">
        @if (!string.IsNullOrEmpty(Model.Message))
        {
            <div class="alert alert-success">@Model.Message</div>
        }
        @if (!string.IsNullOrEmpty(Model.Error))
        {
            <div class="alert alert-danger">@Model.Error</div>
        }
        
        <form method="post" id="usersForm">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th><input type="checkbox" id="selectAll" /></th>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Last Login</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var user in Model.Users)
                    {
                        <tr>
                            <td><input type="checkbox" class="user-checkbox" name="userIds" value="@user.Id" /></td>
                            <td>@user.Name</td>
                            <td>@user.Email</td>
                            <td>@user.LastLogin.ToString("g")</td>
                            <td>
                                <span class="badge @(user.Status == UserStatus.Active ? "bg-success" : "bg-danger")">
                                    @user.Status
                                </span>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </form>
    </div>
</div>

@section Scripts {
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>
        $(document).ready(function() {
            // Select all checkbox functionality
            $('#selectAll').change(function() {
                $('.user-checkbox').prop('checked', $(this).prop('checked'));
            });

            // Block users
            $('#blockUsers').click(function() {
                if ($('.user-checkbox:checked').length === 0) {
                    alert('Please select at least one user');
                    return;
                }
                $('#usersForm').attr('action', '@Url.Page("", "BlockUsers")').submit();
            });

            // Unblock users
            $('#unblockUsers').click(function() {
                if ($('.user-checkbox:checked').length === 0) {
                    alert('Please select at least one user');
                    return;
                }
                $('#usersForm').attr('action', '@Url.Page("", "UnblockUsers")').submit();
            });

            // Delete users
            $('#deleteUsers').click(function() {
                if ($('.user-checkbox:checked').length === 0) {
                    alert('Please select at least one user');
                    return;
                }
                if (confirm('Are you sure you want to delete the selected users?')) {
                    $('#usersForm').attr('action', '@Url.Page("", "DeleteUsers")').submit();
                }
            });
        });
    </script>
}